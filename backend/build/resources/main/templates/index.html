<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Peers</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.3.0/tablesort.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Tablesort for the table
            new Tablesort(document.getElementById('sortable-table'));

            // Filter functionality
            $('#wave-filter, #tribe-filter').on('change', function() {
                const filterWave = $('#wave-filter').val().toLowerCase();
                const filterTribe = $('#tribe-filter').val().toLowerCase();

                $('#sortable-table tbody tr').each(function() {
                    const waveValue = $(this).find('td:nth-child(2)').text().toLowerCase();
                    const tribeValue = $(this).find('td:nth-child(3)').text().toLowerCase();

                    const matchWave = filterWave === '' || waveValue.includes(filterWave);
                    const matchTribe = filterTribe === '' || tribeValue.includes(filterTribe);

                    if (matchWave && matchTribe) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
        });
    </script>
</head>
<body>
<div class="container mt-4">
    <h2>Peers</h2>

    <!-- Dropdown Filters -->
    <div class="row mb-3">
        <div class="col-md-3">
            <label for="wave-filter">Wave:</label>
            <select id="wave-filter" class="form-select">
                <option value="">All</option>
                <option th:each="wave : ${uniqueWaves}" th:value="${value}" th:text="${value}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="tribe-filter">Tribe:</label>
            <select id="tribe-filter" class="form-select">
                <option value="">All</option>
                <option th:each="tribe : ${uniqueTribes}" th:value="${value.id}" th:text="${value.name}"></option>
            </select>
        </div>
    </div>

    <!-- Sortable Table -->
    <table id="sortable-table" class="table table-bordered">
        <thead>
        <tr>
            <th>Login</th>
            <th>Wave</th>
            <th>Tribe</th>
            <th>Exp</th>
            <th>PRP</th>
            <th>CRP</th>
            <th>Coins</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="peer : ${peers}">
            <td th:text="${peer.login}"></td>
            <td th:text="${peer.wave}"></td>
            <td th:text="${peer.tribeData.name}"></td>
            <td th:text="${peer.peerMutableData.expValue}"></td>
            <td th:text="${peer.peerMutableData.peerReviewPoints}"></td>
            <td th:text="${peer.peerMutableData.codeReviewPoints}"></td>
            <td th:text="${peer.peerMutableData.coins}"></td>
        </tr>
        </tbody>
    </table>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled' : ''">
                <a class="page-link" th:href="@{/peers(page=1)}">First</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled' : ''">
                <a class="page-link" th:href="@{/peers(page=${currentPage - 1})}">Previous</a>
            </li>
            <li class="page-item" th:each="page : ${#numbers.sequence(1, totalPages)}" th:classappend="${currentPage == page} ? 'active' : ''">
                <a class="page-link" th:href="@{/peers(page=${page})}" th:text="${page}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled' : ''">
                <a class="page-link" th:href="@{/peers(page=${currentPage + 1})}">Next</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled' : ''">
                <a class="page-link" th:href="@{/peers(page=${totalPages})}">Last</a>
            </li>
        </ul>
    </nav>
</div>
</body>
</html>